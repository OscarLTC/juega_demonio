---
import logoRgx from "../../assets/img/icons/logorgx.png";

interface Props {
  isOpen?: boolean;
}

const { isOpen = false } = Astro.props;
---

<div
  id="pago-recurrente-modal"
  class:list={[
    "fixed inset-0 z-50 flex items-center justify-center",
    isOpen ? "flex" : "hidden"
  ]}
>
  <div class="absolute inset-0 bg-black/53" data-close-modal></div>

  <div class="relative w-[427px] max-h-[90vh] overflow-y-auto bg-[#FFE6F3] rounded-[10px] p-8">
    <button
      type="button"
      data-close-modal
      class="absolute top-4 right-4 text-[#4D4D4D] hover:text-[#202020] transition-colors"
    >
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </button>

    <div class="flex justify-center mb-4">
      <img
        src={logoRgx.src}
        alt="Logo RGX"
        class="w-[172px] h-[76px] object-contain"
      />
    </div>

    <p class="text-center text-[#4D4D4D] font-semibold text-[15.65px] leading-5 mb-6">
      Recuerda activar las <span class="font-bold">compras por internet</span><br/>
      con tu banco
    </p>

    <form id="pago-tarjeta-form" class="space-y-3">
      <input
        type="text"
        name="numero-tarjeta"
        placeholder="Número de tarjeta"
        maxlength="19"
        class="w-full h-[34px] px-4 bg-[#FAF9F9] border border-[#FE8BC6] rounded-[7px] text-xs text-[#6A6A6A] placeholder:text-[#6A6A6A]/70 focus:outline-none focus:border-[#FD0383]"
        required
      />

      <div class="flex gap-2">
        <input
          type="text"
          name="expiry"
          placeholder="MM/AA"
          maxlength="5"
          class="w-1/2 h-[34px] px-4 bg-[#FAF9F9] border border-[#FE8BC6] rounded-[7px] text-xs text-[#6A6A6A] placeholder:text-[#6A6A6A]/70 focus:outline-none focus:border-[#FD0383]"
          required
        />
        <div class="relative w-1/2">
          <input
            type="text"
            name="cvv"
            placeholder="CVV"
            maxlength="4"
            class="w-full h-[34px] px-4 bg-[#FAF9F9] border border-[#FE8BC6] rounded-[7px] text-xs text-[#6A6A6A] placeholder:text-[#6A6A6A]/70 focus:outline-none focus:border-[#FD0383]"
            required
          />
          <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-[#FE8BC6]">
            <svg class="w-[19px] h-[19px]" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>

      <div class="flex gap-2">
        <input
          type="text"
          name="nombre"
          placeholder="Nombre"
          class="w-1/2 h-[34px] px-4 bg-[#FAF9F9] border border-[#FE8BC6] rounded-[7px] text-xs text-[#6A6A6A] placeholder:text-[#6A6A6A]/70 focus:outline-none focus:border-[#FD0383]"
          required
        />
        <input
          type="text"
          name="apellido"
          placeholder="Apellido"
          class="w-1/2 h-[34px] px-4 bg-[#FAF9F9] border border-[#FE8BC6] rounded-[7px] text-xs text-[#6A6A6A] placeholder:text-[#6A6A6A]/70 focus:outline-none focus:border-[#FD0383]"
          required
        />
      </div>

      <input
        type="email"
        name="email"
        placeholder="Email"
        class="w-full h-[34px] px-4 bg-[#FAF9F9] border border-[#FE8BC6] rounded-[7px] text-xs text-[#6A6A6A] placeholder:text-[#6A6A6A]/70 focus:outline-none focus:border-[#FD0383]"
        required
      />

      <input
        type="tel"
        name="movil"
        placeholder="Móvil"
        class="w-full h-[34px] px-4 bg-[#FAF9F9] border border-[#FE8BC6] rounded-[7px] text-xs text-[#6A6A6A] placeholder:text-[#6A6A6A]/70 focus:outline-none focus:border-[#FD0383]"
        required
      />

      <div class="flex gap-2">
        <div class="w-1/2 h-[34px] px-4 bg-[#FAF9F9] border border-[#FE8BC6] rounded-[7px] flex items-center">
          <span class="text-xs text-[#6A6A6A] font-medium">Número de tarjeta</span>
        </div>
        <div class="w-1/2 h-[34px] px-4 bg-[#FAF9F9] border border-[#FE8BC6] rounded-[7px] flex items-center">
          <span class="text-xs text-[#6A6A6A] font-medium">s/. <span id="modal-precio">16.00</span></span>
        </div>
      </div>

      <div class="flex gap-2">
        <div class="w-1/2 h-[34px] px-4 bg-[#FAF9F9] border border-[#FE8BC6] rounded-[7px] flex items-center">
          <span class="text-xs text-[#6A6A6A] font-medium">Número de tarjeta</span>
        </div>
        <div class="w-1/2 h-[34px] px-4 bg-[#FAF9F9] border border-[#FE8BC6] rounded-[7px] flex items-center">
          <span class="text-xs text-[#6A6A6A] font-medium">s/. <span id="modal-precio-2">16.00</span></span>
        </div>
      </div>

      <input
        type="text"
        name="punto-maximo"
        placeholder="Establecer como punto máximo"
        class="w-full h-[34px] px-4 bg-[#FAF9F9] border border-[#FE8BC6] rounded-[7px] text-xs text-[#6A6A6A] placeholder:text-[#6A6A6A]/70 focus:outline-none focus:border-[#FD0383]"
      />

      <button
        type="submit"
        class="w-full h-[37px] bg-[#FD359C] rounded-[7px] text-white font-family-display font-bold text-xl hover:bg-[#FD359C]/90 transition-colors"
      >
        SUSCRIBIRSE
      </button>
    </form>

    <p class="text-center text-[#4D4D4D] text-sm font-light mt-4 leading-[18px]">
      Infórmate sobre el tratamiento de tus datos<br/>
      personales <a href="#" class="underline">aquí</a>
    </p>

    <div class="flex justify-center gap-2 mt-4">
      <div class="w-8 h-8 bg-[#F7F7F7] rounded-full flex items-center justify-center">
        <svg class="w-5 h-3" viewBox="0 0 24 16">
          <circle cx="8" cy="8" r="7" fill="#EB001B"/>
          <circle cx="16" cy="8" r="7" fill="#F79E1B"/>
          <path d="M12 2.5a7 7 0 000 11" fill="#FF5F00"/>
        </svg>
      </div>
      <div class="w-8 h-8 bg-[#F7F7F7] rounded-full flex items-center justify-center">
        <span class="text-[#1434CB] text-[8px] font-bold italic">VISA</span>
      </div>
    </div>
  </div>
</div>

<script>
  function initPagoRecurrenteModal() {
    const modal = document.getElementById('pago-recurrente-modal');
    const closeButtons = modal?.querySelectorAll('[data-close-modal]');
    const form = document.getElementById('pago-tarjeta-form') as HTMLFormElement;

    closeButtons?.forEach(btn => {
      btn.addEventListener('click', () => {
        modal?.classList.add('hidden');
        modal?.classList.remove('flex');
      });
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal?.classList.contains('hidden')) {
        modal?.classList.add('hidden');
        modal?.classList.remove('flex');
      }
    });

    const cardInput = form?.querySelector('[name="numero-tarjeta"]') as HTMLInputElement;
    cardInput?.addEventListener('input', (e) => {
      const target = e.target as HTMLInputElement;
      let value = target.value.replace(/\D/g, '');
      value = value.replace(/(.{4})/g, '$1 ').trim();
      target.value = value;
    });

    const expiryInput = form?.querySelector('[name="expiry"]') as HTMLInputElement;
    expiryInput?.addEventListener('input', (e) => {
      const target = e.target as HTMLInputElement;
      let value = target.value.replace(/\D/g, '');
      if (value.length >= 2) {
        value = value.slice(0, 2) + '/' + value.slice(2);
      }
      target.value = value;
    });

    form?.addEventListener('submit', (e) => {
      e.preventDefault();
      alert('Procesando pago...');
      window.location.href = '/registro/confirmacion';
    });
  }

  (window as any).openPagoRecurrenteModal = () => {
    const modal = document.getElementById('pago-recurrente-modal');
    modal?.classList.remove('hidden');
    modal?.classList.add('flex');
  };

  initPagoRecurrenteModal();
  document.addEventListener('astro:after-swap', initPagoRecurrenteModal);
</script>
